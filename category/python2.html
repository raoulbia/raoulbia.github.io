<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>code repo | articles in the "Python" category | Page 2</title>
    <link rel="shortcut icon" type="image/png" href="../favicon.png">
    <link rel="shortcut icon" type="image/x-icon" href="../favicon.ico">
    <link rel="stylesheet" href="../theme/css/screen.css" type="text/css" />
    <link rel="stylesheet" href="../theme/css/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../theme/css/print.css" type="text/css" media="print" />
    <meta name="generator" content="Pelican" />
    <meta name="description" content="" />
    <meta name="author" content="raoulbia" />
</head>
<body>
    <header>
        <nav>
            <ul>

                <li class="ephemeral selected"><a href="../category/python2.html">Python</a></li>
                <li><a href="../">Home</a></li>
                <li><a href="https://github.com/raoulbia">GitHub</a></li>
                <li><a href="https://stackoverflow.com/users/425727/raoulbia">StackOverflow</a></li>
                <li><a href="../tags">Tags</a></li>
                <li><a href="../categories">Categories</a></li>
                <li><a href="../archives">Archives</a></li>
            </ul>
        </nav>
        <div class="header_box">
            <h1><a href="../">code repo</a></h1>
        </div>
    </header>
    <div id="wrapper">
        <div id="content">            <h4 class="date">Dec 03, 2017</h4>

            <article class="post">
                <h2 class="title">
                    <a href="../python.html" rel="bookmark" title="Permanent Link to &quot;Python&quot;">Python</a>
                </h2>

                
                

                <p>On this page I keep snippets of code I have found useful when working with Python.
Areas covered:</p>
<ul>
<li>File Handling</li>
<li>Data Frames</li>
<li>Lists</li>
<li>Dictionaries</li>
<li>Generators</li>
<li>Iterables</li>
<li>Numpy</li>
<li>Named Tuples</li>
<li>Lambda</li>
<li>About Python Modules</li>
<li>About Python Packages</li>
<li>Python Profiler for Debugging</li>
<li>Misc.</li>
</ul>
<h4>File Handling</h4>
<ul>
<li>
<p>To create a temporary file for unit tests:</p>
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">tomoe.io</span> <span class="kn">import</span> <span class="n">get_tomoe_local_data_dir</span>
<span class="kn">import</span> <span class="nn">tempfile</span>
<span class="n">temp_path</span> <span class="o">=</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">mkdtemp</span><span class="p">(</span><span class="n">suffix</span><span class="o">=</span><span class="s2">&quot;dist-graph-sampling&quot;</span><span class="p">)</span>

 <span class="o">...</span>

<span class="n">TOMOE_TEMP_FOLDER</span> <span class="o">=</span> <span class="n">get_tomoe_local_data_dir</span><span class="p">()</span>

 <span class="o">...</span>
<span class="n">triples_hg_csv_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">temp_path</span><span class="p">,</span> <span class="s1">&#39;triples.hg.csv.tsv&#39;</span><span class="p">)</span>
<span class="n">triple_csv_to_hyperedge_csv</span><span class="p">(</span><span class="n">triples_csv_path</span><span class="p">,</span> <span class="n">triples_hg_csv_path</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">os</span><span class="o">.</span><span class="n">stat</span><span class="p">(</span><span class="n">triples_hg_csv_path</span><span class="p">)</span><span class="o">.</span><span class="n">st_size</span> <span class="o">!=</span> <span class="mi">0</span>
</pre></div>


</li>
<li>
<p><code>with open</code></p>
<p>opening a file with this statement will handle file closing for you</p>
</li>
<li>
<p>The <code>StringIO</code> and <code>cStringIO</code> modules are gone. Instead, import the io module and use <code>io.StringIO</code> for text
  <code>io.BytesIO</code> for data</p>
</li>
<li>
<p>Calling <code>read()</code> reads through the entire file and leaves the read cursor at the end of the file (with nothing more to read).
  Once a file has been read, with <code>read()</code> you can use <code>seek(0)</code> to return the read cursor to the start of the file</p>
</li>
<li>
<p>To check if a file exists or to overwrite an existing file:</p>
<div class="highlight"><pre><span></span>filepath = &#39;local-data/filename.csv&#39;
if os.path.isfile(filepath):
    os.remove(filepath)
tsne_nn_df.to_csv(path_or_buf=filepath,sep=&#39;,&#39;, mode=&#39;a&#39;, header=False)
</pre></div>


</li>
</ul>
<h4>Data Frames</h4>
<ul>
<li>
<p>convert DF column to List:</p>
<div class="highlight"><pre><span></span>sd = []
sd.append(list(df[&#39;a&#39;]))
</pre></div>


</li>
<li>
<p>sort a column by the values in another:</p>
<div class="highlight"><pre><span></span>df_typed[&#39;rank_avg_relevance&#39;] =
    df_typed.groupby(&#39;source_tsne&#39;)[&#39;avg_relevance&#39;].rank(ascending=False)
</pre></div>


<p><a href="http://stackoverflow.com/questions/20183069/how-to-sort-multidimensional-array-by-column">another example from SO</a>:</p>
<div class="highlight"><pre><span></span>`mentionList = sorted(tuple(mentionList), key=lambda x: x[1])`
</pre></div>


</li>
<li>
<p>count <code>NaN</code> in a DF column:</p>
<p><code>num_avg_rel_isnan = df['avg_relevance'].notnull().sum()</code></p>
</li>
<li>
<p>get index based on values in another column:</p>
<p><code>id_in_top5 = np.argsort(df_ranked[rank_column][df_ranked[rank_column] &lt;= 5])[::]</code></p>
</li>
<li>
<p>create rankings: <code>df['rank'] = df.groupby('source')['dist'].rank(ascending=True)</code></p>
</li>
<li>
<p>create a dummy rank</p>
<p>this was used for a list of 10 items where 1 to 5 is already ranked and we need to fill the remaining 5 <code>NaN</code> ranks with ranks 6 to 10.</p>
<div class="highlight"><pre><span></span>def rank2rand(df, col_to_modify):
    counter = it.count(6)
    existing_ranks = np.array(df[[col_to_modify]])
    source = np.array(df[[&#39;source_random&#39;]])
    updated_ranks = [next(counter) if y == 1 else sum(x) for x, y in zip(existing_ranks, source)]
    return updated_ranks
</pre></div>


</li>
<li>
<p>Kendall Tau rank correlation coefficient (<a href="https://en.wikipedia.org/wiki/Kendall_rank_correlation_coefficient">read more</a>)</p>
<div class="highlight"><pre><span></span>def compute_kendall_tau(df_pop):
    # testing
    # x1 = [12, 2, 1, 12, 2]
    # x2 = [1, 4, 7, 1, 0]
    # remove random as they don&#39;t have a rank
    df_pop_kendall = df_pop[df_pop.source_tsne == 1]
    x1 = df_pop_kendall[&#39;rank_tsne&#39;].values
    x2 = df_pop_kendall[&#39;rank_avg_relevance&#39;].values
    tau, p_value = kendalltau(x1, x2) # scipy implementation scipy.stats.kendalltau
    return tau, p_value
</pre></div>


</li>
</ul>
<h4>Lists</h4>
<ul>
<li>
<p>To compare items in two lists:</p>
<div class="highlight"><pre><span></span>for rank_true, rank_pred in zip(true, pred):
    if rank_true == rank_pred:
</pre></div>


</li>
<li>
<p>Pythonic way to print list items: <code>print(*myList, sep='\n')</code></p>
</li>
<li>
<p>To convert a list of chars into proper list:</p>
<div class="highlight"><pre><span></span>list = &#39;123; 456; 887&#39;
ls = list.pop(list).split(&#39;;&#39;)
</pre></div>


</li>
<li>
<p>List Comprehension</p>
<div class="highlight"><pre><span></span>rel_bin = [ None if x == None and y == None
            else x if y == None and not x == None
            else y if x == None and not y == None
            else 0 if x + y == 1
            else 1 if x + y == 2
            else 0 if x + y == 0
            else -9 # to catch any issues
            for x, y in zip(rel_bin_judge_1, rel_bin_judge_2)]
</pre></div>


</li>
</ul>
<h4>Dictionaries</h4>
<ul>
<li>
<p>counting</p>
<div class="highlight"><pre><span></span>context_dic = collections.defaultdict(int)
for res in query_results:
    context_dic[res] += 1
</pre></div>


</li>
<li>
<p><code>Counter</code> class
   <br><br></p>
<div class="highlight"><pre><span></span>d = Counter(self.co_occurrence_counts[&#39;Gene_Gene&#39;][&#39;ent_ab&#39;])
    for k, v in d.most_common(5):
        print(&#39;%s: %i&#39; % (k, v))
</pre></div>


</li>
<li>
<p>double FOR loop for printing each item in list of lists:</p>
<p><code>[print(x) for b in corpus_quads for x in b]</code></p>
<p>example list of lists:</p>
<p><code>[[1281237, 'MESH:D003643', '9606', 'Disease_Species'], [1281237, 'MESH:D001943', 'MESH:D009362', 'Disease_Disease']]</code></p>
</li>
<li>
<p><a href="https://stackoverflow.com/questions/16406329/python-dictionary-count-of-unique-values">about Dicts and counters</a></p>
</li>
</ul>
<h4>Generators</h4>
<ul>
<li>Generators are a way to output a sequence of values without holding the sequence in memory.</li>
<li>A test which raises error if the generator is empty<div class="highlight"><pre><span></span>gen = (i for i in myList)
next(gen)
</pre></div>


</li>
</ul>
<h4>Iterables</h4>
<ul>
<li>
<p>The `enumerate()`` function adds a counter to an iterable. Example:</p>
<div class="highlight"><pre><span></span>for count, elem in enumerate(elements):
    print count, elem
</pre></div>


<p>output:</p>
<div class="highlight"><pre><span></span>0 foo
1 bar
2 baz
</pre></div>


</li>
</ul>
<h4>Numpy</h4>
<ul>
<li>
<p>Remove zeros from numpy array</p>
<div class="highlight"><pre><span></span>index = np.where(y_pred == 0)[0]
    # print(index)
    y_true = np.delete(y_true, index)
    y_pred = np.delete(y_pred, index)
</pre></div>


</li>
<li>
<p>double colon e.g. <code>[::3]</code></p>
<ul>
<li>
<p><code>seq[start:end:step]</code></p>
<p><code>[::3]</code> just means that you have not specified any start or end indices for your slice.</p>
<p>Since you have specified a step, 3, this will take every third entry of something starting at the first index.</p>
<p>For example:</p>
<div class="highlight"><pre><span></span>&#39;123123123&#39;[::3] &gt;&gt; &#39;111&#39;
</pre></div>


</li>
<li>
<p>It can also be used to reverse a list using <code>[::-1]</code>:</p>
<p><code>a[::-1]</code> does not reverse anything, it's just a new view on the same data, more specifically a mirror view.</p>
<p>The method <code>a[::-1].sort()</code> operates on the mirrored image, implying that when sort moves left a smaller item in its
 mirrored image, in reality it is moving it to the right in the real memory block of the a array. The mirrored view is
 sorted in ascending order, the real data is sorted in descending order.
 <a href="https://stackoverflow.com/questions/26984414/efficiently-sorting-a-numpy-array-in-descending-order">source</a></p>
</li>
<li>
<p>what does selection by <code>[:,None]</code> do?</p>
<div class="highlight"><pre><span></span><span class="o">&gt;&gt;&gt;&gt;</span> <span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">NP</span>
<span class="o">&gt;&gt;&gt;&gt;</span> <span class="n">a</span> <span class="o">=</span> <span class="n">NP</span><span class="o">.</span><span class="kp">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;&gt;</span> <span class="k">print</span> <span class="n">a</span>
<span class="p">[</span><span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span><span class="p">]</span>
<span class="o">&gt;&gt;&gt;&gt;</span> <span class="k">print</span> <span class="n">a</span><span class="o">.</span><span class="kp">shape</span>
<span class="p">(</span><span class="mi">4</span><span class="p">,)</span>
<span class="o">&gt;&gt;&gt;&gt;</span> <span class="k">print</span> <span class="n">a</span><span class="p">[:,</span><span class="bp">None</span><span class="p">]</span><span class="o">.</span><span class="kp">shape</span>
<span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;&gt;</span> <span class="k">print</span> <span class="n">a</span><span class="p">[:,</span><span class="bp">None</span><span class="p">]</span>
<span class="p">[[</span><span class="mi">1</span><span class="p">]</span>
 <span class="p">[</span><span class="mi">2</span><span class="p">]</span>
 <span class="p">[</span><span class="mi">3</span><span class="p">]</span>
 <span class="p">[</span><span class="mi">4</span><span class="p">]]</span>
</pre></div>


<p><a href="http://stackoverflow.com/questions/37867354/in-numpy-what-does-selection-by-none-do">read more</a></p>
</li>
</ul>
</li>
</ul>
<h4>Named Tuples</h4>
<div class="highlight"><pre><span></span>print(self.results[0]._fields)
print(&#39;, &#39;.join([&#39;{0}={1}\n&#39;.format(k, getattr(self.results[0], k)) for k in self.results[0]._fields]))
</pre></div>


<p><br></p>
<div class="highlight"><pre><span></span>self.Result = collections.namedtuple(&#39;Result&#39;, (&#39;embedding&#39;, &#39;entity&#39;, &#39;type&#39;,
                                                   &#39;precision&#39;, &#39;recall&#39;,...))


self.results = []
elf.results.append(self.Result(embedding=source,
                                          entity=entity,
                                          type=type,
                                          precision=precision,
                                          recall=recall,
                                          ...
                                          ))
results_df = pd.DataFrame(results, columns=results[0]._fields)
t_by_emb = results_df.groupby([&#39;embedding&#39;]).mean()
t_by_emb_bio = results_df.groupby([&#39;embedding&#39;, &#39;entity&#39;]).mean()
t_by_emb_type = results_df.groupby([&#39;embedding&#39;, &#39;type&#39;]).mean()
t_by_emb, t_by_emb_bio, t_by_emb_type = t_by_emb.T, t_by_emb_bio.T, t_by_emb_type.T
</pre></div>


<p><strong>Note</strong>
Named tuples are immutable, so you cannot manipulate them.
If you want something mutable, you can use recordtype.
<a href="https://stackoverflow.com/questions/31252939/changing-values-of-a-list-of-namedtuples">read more</a></p>
<h4>Lambda</h4>
<div class="highlight"><pre><span></span>def transform():
    return lambda x: 2**x
f = transform()
print(f(-2))
</pre></div>


<ul>
<li>lambda and dataframes<div class="highlight"><pre><span></span>df = df.apply(lambda x: x.astype(str).str.upper())

df[&#39;Score&#39;] = df[&#39;Score&#39;].apply(lambda x: sigmoid(float(x)))

df[&#39;string_id&#39;] = df[&#39;string_id&#39;].apply(lambda id_string: &#39;9606.&#39; + id_string)
</pre></div>


</li>
</ul>
<h4>About Python Modules</h4>
<ul>
<li>
<p>When getting error: <code>module ... not found</code>: <a href="http://askubuntu.com/questions/470982/how-to-add-a-python-module-to-syspath">see here</a></p>
</li>
<li>
<p>Working with modules from other projects</p>
<p>To prevent getting error <code>no module named...</code> resp. before importing a module from a different project make sure to run:
<code>$ python setup.py install</code></p>
</li>
<li>
<p>How to get <code>import</code> of modules to work (<a href="http://stackoverflow.com/questions/36650163/cant-import-from-specific-folder-in-pycharm">source</a>)</p>
<p>Modules are imported from a Python Package, not from a Directory. Therefore, instead of storing python scripts in a
directory, store them in a Python Package: right-click on your project directory, choose Python Package.</p>
<p>Alternatively, in the existing directory, create an empty <code>__init__.py</code> file.</p>
</li>
<li>
<p>About <code>__init__.py</code></p>
<p>In order for Python to see the modules inside each subdirectory, add a blank file called <code>__init__.py</code> to each
subdirectory (with two underscores on each side). <a href="http://www.bdnyc.org/2012/09/editing-pythonpath-to-import-modules/">read more</a></p>
</li>
</ul>
<h4>About Python Packages</h4>
<ul>
<li>To list installed packages<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pip</span>
<span class="n">installed_packages</span> <span class="o">=</span> <span class="n">pip</span><span class="o">.</span><span class="n">get_installed_distributions</span><span class="p">()</span>
<span class="n">installed_packages_list</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">([</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">==</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">key</span><span class="p">,</span> <span class="n">i</span><span class="o">.</span><span class="n">version</span><span class="p">)</span>
     <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">installed_packages</span><span class="p">])</span>
<span class="k">print</span><span class="p">(</span><span class="n">installed_packages_list</span><span class="p">)</span>
</pre></div>


</li>
</ul>
<h4>Python Profiler for Debugging</h4>
<p>Pre-requiste: <code>conda install -c anaconda line_profiler</code></p>
<ol>
<li>
<p>create a shell script in the directory of the script you want to profile</p>
<p>1.1 <code>cat profile_my_script.sh</code></p>
<p>1.2. After pressing Enter, you are not returned to the terminal prompt.
     Instead, the cursor is placed on the next line, and you can start
     entering text directly into your file. Type the text below,
     pressing Enter after each line. When you are done, press Ctrl+D to
     exit the file and return to the prompt.</p>
<div class="highlight"><pre><span></span> #!/bin/bash -x
 kernprof -lv my_script.py
 time python3 my_script.py
</pre></div>


</li>
<li>
<p>add <code>@profile</code> at the start of each function you want to profile</p>
</li>
<li>
<p>in <a href="https://www.jetbrains.com/pycharm/">Pycharm</a> development workflow: open console (Alt+F12),
   cd into directory where scripts are located and run <code>bash profile_my_script.sh</code></p>
</li>
</ol>
<h4>Misc.</h4>
<ul>
<li>
<p>first line in a script: <code># -*- coding: utf-8 -*-</code></p>
</li>
<li>
<p>Getting wider output in PyCharm's built-in console:</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="kn">as</span> <span class="nn">pd</span>
<span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s1">&#39;display.width&#39;</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>
</pre></div>


</li>
<li>
<p>To get the type of some variable: <code>print(type(list_cluster_entities))</code></p>
</li>
<li>
<p>About <code>action="store_true"</code>: <a href="https://docs.python.org/2/howto/argparse.html">see here</a></p>
</li>
<li>
<p>About PYTHONPATH</p>
<ul>
<li><code>PYTHONPATH</code> is the module search path</li>
<li><code>PYTHONHOME</code> is used for the standard libraries,</li>
</ul>
</li>
<li>
<p>Logging &amp; Try/Except</p>
<div class="highlight"><pre><span></span>def build_pathway_dataset(self, list-of-args, **kwargs):
    logger = logging.getLogger(self.__class__.__qualname__)
    try:
        if pathway:
            logger.info(&#39;Building Pathway Data Set&#39;)
            t0 = time.time()
            dataset = PathwayDataset(list-of-args)
            dataset.build(pathway_limit=pathway_limit)
            t1 = time.time()
            logger.info(&#39;finished in %5.2f s&#39;, t1-t0)
        else:
            logger.info(&#39;dataset will not be built&#39;)
    except Exception as e:
        logger.exception(&#39;\n&#39;.join(traceback.format_exception(type(e), e, sys.exc_info()[2])))
        raise e
</pre></div>


</li>
</ul>
                <div class="clear"></div>

                <div class="info">
                    <a href="../python.html">posted at 10:20</a>
                    &nbsp;&middot;&nbsp;<a href="../category/python.html" rel="tag">Python</a>
                    &nbsp;&middot;
                    &nbsp;<a href="../tag/python.html" class="tags">python</a>
                </div>
		<a href="../python.html#disqus_thread">Click to read and post comments</a>
            </article>            <h4 class="date">Dec 03, 2017</h4>

            <article class="post">
                <h2 class="title">
                    <a href="../python, pandas.html" rel="bookmark" title="Permanent Link to &quot;pandas: Python Data Analysis Library&quot;">pandas: Python Data Analysis Library</a>
                </h2>

                
                

                <p><a href="http://chrisalbon.com/python/pandas_indexing_selecting.html">Indexing and Selecting Data With Pandas</a></p>
<h5>Selecting Data</h5>
<ul>
<li>
<p>select DF subset</p>
<div class="highlight"><pre><span></span>self.df_co_occurrences[
    (self.df_co_occurrences.ent_a == &#39;4040&#39;)
    (self.df_co_occurrences.ent_b == &#39;5267&#39;)]
</pre></div>


</li>
<li>
<p>get two columns for a specific row</p>
<div class="highlight"><pre><span></span>embeddings_df.ix[[input_entity_uri]][[&#39;transformed_x&#39;, &#39;transformed_y&#39;]]
</pre></div>


</li>
<li>
<p>find rows by column index and with condition</p>
<div class="highlight"><pre><span></span>assign_clusters_df[assign_clusters_df[1]==2]
</pre></div>


</li>
<li>
<p>mapping an index column using values from another df</p>
<div class="highlight"><pre><span></span>embeddings_df.index = embeddings_node_dict_df.uri
</pre></div>


</li>
<li>
<p>refer to a specific row in 1-dimensional DF</p>
<div class="highlight"><pre><span></span>df[0][index]
</pre></div>


</li>
<li>
<p>refer to a specific row in 2-dimensional DF</p>
<div class="highlight"><pre><span></span>df[0][0][index]
</pre></div>


</li>
<li>
<p><code>.iloc</code> vs. <code>.ix</code></p>
<p>iloc:</p>
<div class="highlight"><pre><span></span>if embeddings_df.iloc[row_id].name == input_entity_uri
</pre></div>


<p>ix:</p>
<div class="highlight"><pre><span></span>neigh.kneighbors(embeddings_df.ix[[input_entity_uri]]
</pre></div>


</li>
<li>
<p>select using <code>.loc</code> and <code>.iloc</code></p>
<p>def get_pmi(ent_ab, df, count_ab, ent_a_count, ent_b_count):
    count_ab = df.loc[df['ent_ab'] == ent_ab, 'count_ab'].iloc[0]
    ent_a_count = df.loc[df['ent_ab'] == ent_ab, 'ent_a_count'].iloc[0]
    ent_b_count = df.loc[df['ent_ab'] == ent_ab, 'ent_b_count'].iloc[0]
    return count_ab / (ent_a_count * ent_b_count)</p>
</li>
<li>
<p>concatenate rows from multiple files into one DF</p>
<div class="highlight"><pre><span></span>def read(input_eval_dp):
    files = os.listdir(input_eval_dp)

    # add all scores from the various files to one DF
    eval_df = pd.DataFrame()
    for file in files:
        print(files)
        fp = os.path.join(input_eval_dp, file)
        print(fp)

        tmp_df = get_eval(fp)
        eval_df = pd.concat([eval_df, tmp_df])
        # print(eval_df.shape)
    # print(eval_df.head())
    return eval_df
</pre></div>


</li>
</ul>
<h5>File Handling</h5>
<ul>
<li>write to file<div class="highlight"><pre><span></span>neighbors_df.to_csv(path_or_buf=&quot;./neighbors.csv&quot;, sep=&#39;,&#39;)
</pre></div>


</li>
</ul>
<h5>Pandas to List</h5>
<ul>
<li>
<p>convert dataframe column to list</p>
<div class="highlight"><pre><span></span>entity_list = entity_list_df[&#39;uri&#39;].tolist()
</pre></div>


</li>
<li>
<p>create one big list of ID's from two DF columns that contain IDs</p>
<div class="highlight"><pre><span></span>triples = pandas.read_csv(f, sep=&#39;\t&#39;).ix[:, [0, 2]].as_matrix()
phosphonetowrk_IDs = set(triples.flatten())
</pre></div>


</li>
</ul>
<h5>Console Output</h5>
<ul>
<li>
<p>print a n-dimensional array e.g. [[...],[...]]</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pprint</span>
<span class="n">pprint</span><span class="o">.</span><span class="n">pprint</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
</pre></div>


</li>
<li>
<p>Transpose index and columns</p>
<p>assign_clusters_df = pd.DataFrame([embeddings_bio_df.index, db.labels_]).T</p>
</li>
</ul>
<h5>Drop / Remove Data</h5>
<ul>
<li>
<p>remove elements from a lookup list</p>
<div class="highlight"><pre><span></span>df = df[~df.uri.isin(list_cluster_entities)]
</pre></div>


</li>
<li>
<p>drop any NaN in any column</p>
<div class="highlight"><pre><span></span>embeddings_bio_df = embeddings_df[~embeddings_df.isin([&#39;NaN&#39;]).any(axis=1)]
</pre></div>


</li>
<li>
<p>drop a spcific column</p>
<div class="highlight"><pre><span></span>neighbors_df = neighbors_df.drop(&#39;uri.1&#39;, 1)
</pre></div>


</li>
<li>
<p>Add col with new value based on values in three other cols:</p>
<div class="highlight"><pre><span></span>df_ab[&#39;pmi&#39;] = df_ab.ent_ab.apply(get_pmi, args=(df_ab, &#39;count_ab&#39;, &#39;ent_a_count&#39;, &#39;ent_b_count&#39;, ))
</pre></div>


</li>
</ul>
<h5>Insert Data</h5>
<ul>
<li>
<p>add row by row to df using counter of enumerator</p>
<p>df.loc[str(counter)] = [other_df.iloc[row_id].name,
                                    str(round(res[0][0][index], 3))]</p>
</li>
</ul>
<h4>DF to Triples</h4>
<ul>
<li>
<p>reshape rcsi data to triples in the form <code>(coder,item,label)</code></p>
<p>Input:</p>
<div class="highlight"><pre><span></span>Unit    obs1    obs2    obs3    obs4    obs5
1       1       1       2       .       2
2       1       1       0       1       .
3       2       3       3       3       .
4       .       0       0       .       0
5       0       0       0       .       0
6       0       0       0       .       0
7       1       0       2       .       1
</pre></div>


<p>Code:</p>
<div class="highlight"><pre><span></span>df = pd.DataFrame()
for index, row in other_df.iterrows():
    df = df.append({&#39;coder&#39;: &#39;obs_1&#39;, &#39;item&#39;: index, &#39;label&#39;: row[&#39;obs1&#39;]}, ignore_index=True)
    df = df.append({&#39;coder&#39;: &#39;obs_2&#39;, &#39;item&#39;: index, &#39;label&#39;: row[&#39;obs2&#39;]}, ignore_index=True)
    df = df.append({&#39;coder&#39;: &#39;obs_3&#39;, &#39;item&#39;: index, &#39;label&#39;: row[&#39;obs3&#39;]}, ignore_index=True)
    df = df.append({&#39;coder&#39;: &#39;obs_4&#39;, &#39;item&#39;: index, &#39;label&#39;: row[&#39;obs4&#39;]}, ignore_index=True)
    df = df.append({&#39;coder&#39;: &#39;obs_5&#39;, &#39;item&#39;: index, &#39;label&#39;: row[&#39;obs5&#39;]}, ignore_index=True)
print(df)
</pre></div>


</li>
</ul>
<h5>Pandas to Matrix</h5>
<ul>
<li>transforming columns into a matrix for <a href="http://scikit-learn.org/stable/modules/generated/sklearn.metrics.cohen_kappa_score.html">scikit learn cohen coefficient</a><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">itertools</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="kn">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">cohen_kappa_score</span>
<span class="n">files</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">input_eval_dp</span><span class="p">)</span>
<span class="k">for</span> <span class="nb">file</span><span class="p">,</span> <span class="nb">type</span> <span class="ow">in</span> <span class="n">itertools</span><span class="o">.</span><span class="kp">product</span><span class="p">(</span><span class="n">files</span><span class="p">,</span> <span class="n">type_label_list</span><span class="p">):</span>
    <span class="n">fp</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">input_eval_dp</span><span class="p">,</span> <span class="nb">file</span><span class="p">)</span>
    <span class="n">eval_df</span> <span class="o">=</span> <span class="n">get_eval</span><span class="p">(</span><span class="n">fp</span><span class="p">)</span>
    <span class="n">eval_typed_df</span> <span class="o">=</span> <span class="n">eval_df</span><span class="p">[</span><span class="n">eval_df</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="nb">type</span><span class="p">]</span>

    <span class="c1"># remove any rows where at least one NA is found</span>
    <span class="n">eval_typed_df</span> <span class="o">=</span> <span class="n">eval_typed_df</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;judge_1&#39;</span><span class="p">,</span> <span class="s1">&#39;judge_2&#39;</span><span class="p">])</span>

    <span class="c1"># transform the three columns with scores into a 15 x 3 matrix</span>
    <span class="n">rankings</span> <span class="o">=</span> <span class="n">eval_typed_df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="o">-</span><span class="mi">3</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="kp">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span><span class="o">.</span><span class="n">as_matrix</span><span class="p">()</span>

    <span class="n">judge_A_matrix</span> <span class="o">=</span> <span class="n">rankings</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
    <span class="n">judge_B_matrix</span> <span class="o">=</span> <span class="n">rankings</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>

    <span class="c1"># Kappa Cohen 2 annotators</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&#39;{}&#39;</span><span class="se">\t</span><span class="s2">inter annotator agreement between judge A and judge B&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">))</span>
    <span class="n">cohen_kappa</span><span class="p">(</span><span class="n">judge_A_matrix</span><span class="p">,</span> <span class="n">judge_B_matrix</span><span class="p">)</span>
</pre></div>


</li>
</ul>
<h4>pandas.DataFrame.apply (<a href="https://pandas.pydata.org/pandas-docs/stable/generated/pandas.DataFrame.apply.html">read more</a>)</h4>
<ul>
<li>
<p>pass DF to Apply function pandas as argument (<a href="https://stackoverflow.com/questions/45492306/pass-dataframe-to-apply-function-pandas-as-argument">SO post</a>)</p>
<p>df_a</p>
<div class="highlight"><pre><span></span>   ent_a  count
0   5197    1.0
1  12766    2.0
2   3091    2.0
3   3162    1.0
4   1956   13.0
</pre></div>


<p>df_ab</p>
<div class="highlight"><pre><span></span>       ent_ab  count_ab
0   5197-56744       1.0
1   12766-5197       1.0
2  12766-56744       1.0
3    3091-3162       1.0
4   3091-54583       1.0
</pre></div>


<p>Add column:</p>
<div class="highlight"><pre><span></span>df_ab[&#39;ent_a&#39;] = df_ab.ent_ab.apply(lambda x: x.split(&#39;-&#39;)[0])
</pre></div>


<p>df_ab:</p>
<div class="highlight"><pre><span></span>        ent_ab  count_ab  ent_a
0   5197-56744       1.0   5197
1   12766-5197       1.0  12766
2  12766-56744       1.0  12766
3    3091-3162       1.0   3091
4   3091-54583       1.0   3091
</pre></div>


<p>Add column from df_a to df_ab:</p>
<div class="highlight"><pre><span></span>df_ab[&#39;ent_a_count&#39;] = df_ab.ent_a.apply(get_ent, args=(df_a, &#39;ent_a&#39;, ))
</pre></div>


<p>Apply function:</p>
<div class="highlight"><pre><span></span>def get_ent(ent_df_a, df_a, colname_df_ab):
    row_df_a = df_a[df_a[colname_df_ab] == ent_df_a]
    i = row_df_a.iloc[0][&#39;count&#39;]
    return i
</pre></div>


<p>df_ab</p>
<div class="highlight"><pre><span></span>        ent_ab  count_ab  ent_a  ent_b  ent_a_count
0   5197-56744       1.0   5197  56744          1.0
1   12766-5197       1.0  12766   5197          2.0
2  12766-56744       1.0  12766  56744          2.0
3    3091-3162       1.0   3091   3162          2.0
4   3091-54583       1.0   3091  54583          2.0
</pre></div>


</li>
</ul>
                <div class="clear"></div>

                <div class="info">
                    <a href="../python, pandas.html">posted at 10:20</a>
                    &nbsp;&middot;&nbsp;<a href="../category/python.html" rel="tag">Python</a>
                    &nbsp;&middot;
                    &nbsp;<a href="../tag/pandas.html" class="tags">pandas</a>
                </div>
		<a href="../python, pandas.html#disqus_thread">Click to read and post comments</a>
            </article>

                <div class="clear"></div>
                <div class="pages">

                    <a href="../category/python.html" class="prev_page">&larr;&nbsp;Previous</a>
                    <a href="../category/python3.html" class="next_page">Next&nbsp;&rarr;</a>
                    <span>Page 2 of 3</span>
                </div>

            <div class="clear"></div>
            <footer>
                <p>
                <a href="https://github.com/jody-frankowski/blue-penguin">Blue Penguin</a> Theme
                &middot;
                Powered by <a href="http://getpelican.com">Pelican</a>
            </footer>
        </div>
        <div class="clear"></div>
    </div>
</body>
</html>